<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BMC Creator - Business Model Canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      .section-card {
        transition: all 0.3s ease;
      }
      .section-card:hover {
        transform: translateY(-4px);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .sidebar {
        transition: transform 0.3s ease;
      }
      .sidebar-closed {
        transform: translateX(-100%);
      }
      .edit-mode .section-card {
        cursor: pointer;
      }
      .edit-mode .section-card:hover {
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
      }
      @media print {
        .no-print {
          display: none !important;
        }
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#eef2ff',
                100: '#e0e7ff',
                500: '#6366f1',
                600: '#4f46e5',
                700: '#4338ca',
                900: '#312e81',
              },
              dark: { 800: '#1e293b', 900: '#0f172a' },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50 dark:bg-dark-900 transition-colors duration-300">
    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="sidebar fixed left-0 top-0 h-full w-64 bg-white dark:bg-dark-800 shadow-2xl z-50 no-print">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h2
            class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
            <i class="fas fa-chart-line text-primary-500"></i>
            BMC Creator
          </h2>
          <button
            onclick="toggleSidebar()"
            class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>

      <nav class="p-4 space-y-2">
        <button
          onclick="toggleEditMode()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-edit w-5"></i>
          <span id="editModeText">Enable Edit Mode</span>
        </button>

        <button
          onclick="exportAsImage()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-image w-5"></i>
          <span>Export as Image</span>
        </button>

        <button
          onclick="exportAsPDF()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-file-pdf w-5"></i>
          <span>Export as PDF</span>
        </button>

        <button
          onclick="saveToDB()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-cloud-upload-alt w-5"></i>
          <span>Save to Database</span>
        </button>

        <button
          onclick="loadFromDB()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-cloud-download-alt w-5"></i>
          <span>Load from Database</span>
        </button>

        <button
          onclick="exportJSON()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i class="fas fa-file-export w-5"></i>
          <span>Export JSON</span>
        </button>

        <div class="border-t border-gray-200 dark:border-gray-700 my-4"></div>

        <button
          onclick="toggleTheme()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-dark-900 text-gray-700 dark:text-gray-300 transition">
          <i id="themeIcon" class="fas fa-moon w-5"></i>
          <span id="themeText">Dark Mode</span>
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="lg:ml-64 min-h-screen">
      <!-- Header -->
      <header
        class="bg-white dark:bg-dark-800 shadow-sm sticky top-0 z-40 no-print">
        <div class="px-4 py-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between">
            <button
              onclick="toggleSidebar()"
              class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400">
              <i class="fas fa-bars text-xl"></i>
            </button>

            <h1
              class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3">
              <i class="fas fa-layer-group text-primary-500"></i>
              Business Model Canvas
            </h1>

            <div class="flex items-center gap-4">
              <span
                id="editModeBadge"
                class="hidden px-3 py-1 bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300 rounded-full text-sm font-medium">
                <i class="fas fa-lock-open mr-1"></i> Edit Mode
              </span>
            </div>
          </div>
        </div>
      </header>

      <!-- Canvas Content -->
      <main class="p-4 sm:p-6 lg:p-8">
        <div class="max-w-[1600px] mx-auto">
          <div
            class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
            <p
              class="text-sm text-blue-800 dark:text-blue-300 flex items-center gap-2">
              <i class="fas fa-info-circle"></i>
              <span
                ><strong>Project:</strong> Cybersecurity Training Platform</span
              >
            </p>
          </div>

          <div
            id="canvasGrid"
            class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 fade-in">
            <!-- Sections will be rendered here -->
          </div>
        </div>
      </main>
    </div>

    <!-- Password Modal -->
    <div
      id="passwordModal"
      class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 no-print">
      <div
        class="bg-white dark:bg-dark-800 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6">
        <h3
          class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="fas fa-lock text-primary-500"></i>
          Enter Password
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Owner authentication required to edit
        </p>
        <input
          type="password"
          id="passwordInput"
          placeholder="Enter password"
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-dark-900 dark:text-white mb-4" />
        <div class="flex gap-3">
          <button
            onclick="verifyPassword()"
            class="flex-1 bg-primary-500 hover:bg-primary-600 text-white px-6 py-3 rounded-lg font-medium transition">
            Verify
          </button>
          <button
            onclick="closePasswordModal()"
            class="flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-6 py-3 rounded-lg font-medium transition">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div
      id="editModal"
      class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 no-print">
      <div
        class="bg-white dark:bg-dark-800 rounded-xl shadow-2xl w-full max-w-2xl mx-4 p-6">
        <h3
          class="text-xl font-bold text-gray-900 dark:text-white mb-4"
          id="editModalTitle">
          Edit Section
        </h3>
        <textarea
          id="editModalInput"
          rows="6"
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-dark-900 dark:text-white mb-4 resize-none"></textarea>
        <div class="flex gap-3">
          <button
            onclick="saveItem()"
            class="flex-1 bg-primary-500 hover:bg-primary-600 text-white px-6 py-3 rounded-lg font-medium transition">
            <i class="fas fa-save mr-2"></i> Save
          </button>
          <button
            onclick="closeEditModal()"
            class="flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-6 py-3 rounded-lg font-medium transition">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Notification -->
    <div
      id="notification"
      class="hidden fixed top-4 right-4 bg-white dark:bg-dark-800 shadow-xl rounded-lg px-6 py-4 z-[60] no-print">
      <div class="flex items-center gap-3">
        <i id="notifIcon" class="fas fa-check-circle text-2xl"></i>
        <p id="notifText" class="text-gray-800 dark:text-white font-medium"></p>
      </div>
    </div>

    <script>
      const CONFIG = {
        password: 'owner123',
        mongodbUri:
          'mongodb+srv://node1_db:node1_db@cluster0.aiysocq.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0',
        dbName: 'bmc_database',
        collectionName: 'canvas_data',
      };

      const SECTIONS = [
        {
          id: 'key-partners',
          title: 'Key Partners',
          icon: 'handshake',
          color: 'blue',
          col: 'lg:col-span-1',
          row: 'lg:row-span-2',
        },
        {
          id: 'key-activities',
          title: 'Key Activities',
          icon: 'cogs',
          color: 'purple',
          col: 'lg:col-span-1',
          row: 'lg:row-span-1',
        },
        {
          id: 'value-propositions',
          title: 'Value Propositions',
          icon: 'gem',
          color: 'pink',
          col: 'lg:col-span-1',
          row: 'lg:row-span-2',
        },
        {
          id: 'customer-relationships',
          title: 'Customer Relationships',
          icon: 'heart',
          color: 'red',
          col: 'lg:col-span-1',
          row: 'lg:row-span-1',
        },
        {
          id: 'customer-segments',
          title: 'Customer Segments',
          icon: 'users',
          color: 'green',
          col: 'lg:col-span-1',
          row: 'lg:row-span-2',
        },
        {
          id: 'key-resources',
          title: 'Key Resources',
          icon: 'briefcase',
          color: 'yellow',
          col: 'lg:col-span-1',
          row: 'lg:row-span-1',
        },
        {
          id: 'channels',
          title: 'Channels',
          icon: 'broadcast-tower',
          color: 'indigo',
          col: 'lg:col-span-1',
          row: 'lg:row-span-1',
        },
        {
          id: 'cost-structure',
          title: 'Cost Structure',
          icon: 'dollar-sign',
          color: 'orange',
          col: 'lg:col-span-3',
          row: 'lg:row-span-1',
        },
        {
          id: 'revenue-streams',
          title: 'Revenue Streams',
          icon: 'coins',
          color: 'teal',
          col: 'lg:col-span-2',
          row: 'lg:row-span-1',
        },
      ];

      let canvasData = {
        'key-partners': [
          'Educational Institutions: Universities & Training Centers',
          'Housing Provider: Physical office/lab space',
          'Certification Bodies: Cybersecurity providers',
          'Content Partners: Industry experts & influencers',
          'Payment Processors: PayPal, local banks',
        ],
        'key-activities': [
          'Content Development: Creating courses & labs',
          'Platform Maintenance: Updating virtual labs',
          'Community Engagement: Forums, webinars',
          'Marketing & Sales: University partnerships',
          'Certification Management',
          'Content Updates: New cyber threats',
        ],
        'value-propositions': [
          'Accessibility: Affordable & beginner-friendly',
          'Practical Learning: Hands-on labs & gamification',
          'Structured Paths: Basic to advanced learning',
        ],
        'customer-relationships': [
          'Community Support: Discord & Telegram',
          'Interactive Learning: Mentorship & live Q&A',
          'Personalization: Custom learning paths',
          'Recognition: Completion certificates',
          'Dedicated Support: Human assistance',
        ],
        'customer-segments': [
          'Students & Graduates: University students',
          'Career Changers: Beginners & self-learners',
          'Professionals: IT professionals upskilling',
        ],
        'key-resources': [
          'Personnel: Web developers (Front/Back-end)',
          'Cybersecurity engineers',
          'Marketing team',
          'Industry contacts',
        ],
        channels: [
          'Digital Platform: Website & mobile app',
          'Academic Partnerships: Universities',
          'Industry Presence: Events & conferences',
          'Social Media: LinkedIn, YouTube, Twitter, TikTok',
        ],
        'cost-structure': [
          'Operational: Office rent & salaries',
          'Marketing & advertising',
          'Technology: Hosting & infrastructure',
          'Content Production: Videos & labs',
          'Licensing: Certifications & software',
        ],
        'revenue-streams': [
          'Subscriptions: Monthly/quarterly plans',
          'Freemium Model: Basic free, paid advanced',
          'Certification Fees: Exams & attempts',
          'Sponsorships: Company partnerships',
          'Paid Events: Workshops & bootcamps',
        ],
      };

      let state = {
        editMode: false,
        darkMode: false,
        sidebarOpen: window.innerWidth >= 1024,
        currentSection: null,
        currentIndex: -1,
      };

      function init() {
        loadTheme();
        renderCanvas();
        loadFromStorage();
      }

      function renderCanvas() {
        const grid = document.getElementById('canvasGrid');
        grid.innerHTML = SECTIONS.map(
          (section) => `
                <div class="section-card ${section.col} ${
            section.row
          } bg-white dark:bg-dark-800 rounded-xl shadow-md p-6 border-t-4 border-${
            section.color
          }-500" data-section="${section.id}">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                            <i class="fas fa-${section.icon} text-${
            section.color
          }-500"></i>
                            ${section.title}
                        </h3>
                        ${
                          state.editMode
                            ? `<button onclick="addItem('${section.id}')" class="text-${section.color}-500 hover:text-${section.color}-700 transition"><i class="fas fa-plus-circle"></i></button>`
                            : ''
                        }
                    </div>
                    <ul id="${
                      section.id
                    }-list" class="space-y-2 text-sm text-gray-700 dark:text-gray-300"></ul>
                </div>
            `
        ).join('');

        SECTIONS.forEach((section) => renderSection(section.id));
        updateEditModeUI();
      }

      function renderSection(sectionId) {
        const list = document.getElementById(`${sectionId}-list`);
        list.innerHTML = canvasData[sectionId]
          .map(
            (item, idx) => `
                <li class="flex items-start gap-2 p-2 rounded hover:bg-gray-50 dark:hover:bg-dark-900 transition group">
                    <i class="fas fa-circle text-xs text-primary-500 mt-1.5"></i>
                    <span class="flex-1">${item}</span>
                    ${
                      state.editMode
                        ? `
                        <div class="opacity-0 group-hover:opacity-100 transition flex gap-1">
                            <button onclick="editItem('${sectionId}', ${idx})" class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteItem('${sectionId}', ${idx})" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                        </div>
                    `
                        : ''
                    }
                </li>
            `
          )
          .join('');
      }

      function toggleSidebar() {
        state.sidebarOpen = !state.sidebarOpen;
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('sidebar-closed', !state.sidebarOpen);
      }

      function toggleEditMode() {
        if (!state.editMode) {
          document.getElementById('passwordModal').classList.remove('hidden');
        } else {
          state.editMode = false;
          renderCanvas();
          showNotification('Edit mode disabled', 'info');
        }
      }

      function verifyPassword() {
        const password = document.getElementById('passwordInput').value;
        if (password === CONFIG.password) {
          state.editMode = true;
          closePasswordModal();
          renderCanvas();
          showNotification('Edit mode enabled', 'success');
        } else {
          showNotification('Incorrect password. Only owner can edit!', 'error');
        }
      }

      function closePasswordModal() {
        document.getElementById('passwordModal').classList.add('hidden');
        document.getElementById('passwordInput').value = '';
      }

      function updateEditModeUI() {
        document
          .getElementById('editModeBadge')
          .classList.toggle('hidden', !state.editMode);
        document.getElementById('editModeText').textContent = state.editMode
          ? 'Disable Edit Mode'
          : 'Enable Edit Mode';
        document
          .getElementById('canvasGrid')
          .classList.toggle('edit-mode', state.editMode);
      }

      function addItem(sectionId) {
        state.currentSection = sectionId;
        state.currentIndex = -1;
        document.getElementById('editModalTitle').textContent = `Add to ${
          SECTIONS.find((s) => s.id === sectionId).title
        }`;
        document.getElementById('editModalInput').value = '';
        document.getElementById('editModal').classList.remove('hidden');
      }

      function editItem(sectionId, idx) {
        state.currentSection = sectionId;
        state.currentIndex = idx;
        document.getElementById('editModalTitle').textContent = `Edit ${
          SECTIONS.find((s) => s.id === sectionId).title
        }`;
        document.getElementById('editModalInput').value =
          canvasData[sectionId][idx];
        document.getElementById('editModal').classList.remove('hidden');
      }

      function deleteItem(sectionId, idx) {
        if (confirm('Are you sure you want to delete this item?')) {
          canvasData[sectionId].splice(idx, 1);
          renderSection(sectionId);
          saveToStorage();
          showNotification('Item deleted', 'success');
        }
      }

      function saveItem() {
        const value = document.getElementById('editModalInput').value.trim();
        if (!value) return showNotification('Please enter a value', 'error');

        if (state.currentIndex === -1) {
          canvasData[state.currentSection].push(value);
        } else {
          canvasData[state.currentSection][state.currentIndex] = value;
        }

        renderSection(state.currentSection);
        closeEditModal();
        saveToStorage();
        showNotification('Changes saved', 'success');
      }

      function closeEditModal() {
        document.getElementById('editModal').classList.add('hidden');
      }

      function toggleTheme() {
        state.darkMode = !state.darkMode;
        document.documentElement.classList.toggle('dark', state.darkMode);
        localStorage.setItem('theme', state.darkMode ? 'dark' : 'light');
        document.getElementById('themeIcon').className = state.darkMode
          ? 'fas fa-sun w-5'
          : 'fas fa-moon w-5';
        document.getElementById('themeText').textContent = state.darkMode
          ? 'Light Mode'
          : 'Dark Mode';
      }

      function loadTheme() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          state.darkMode = true;
          document.documentElement.classList.add('dark');
          document.getElementById('themeIcon').className = 'fas fa-sun w-5';
          document.getElementById('themeText').textContent = 'Light Mode';
        }
      }

      function saveToStorage() {
        localStorage.setItem('bmc_canvas', JSON.stringify(canvasData));
      }

      function loadFromStorage() {
        const saved = localStorage.getItem('bmc_canvas');
        if (saved) {
          canvasData = JSON.parse(saved);
          renderCanvas();
        }
      }

      async function saveToDB() {
        try {
          const data = {
            projectName: 'Cybersecurity Training Platform',
            timestamp: new Date().toISOString(),
            canvasData,
          };
          saveToStorage();
          showNotification(
            'Saved to local storage (MongoDB integration requires backend)',
            'info'
          );
          console.log('Data ready for MongoDB:', data);
        } catch (error) {
          showNotification('Save failed', 'error');
        }
      }

      function loadFromDB() {
        loadFromStorage();
        showNotification('Loaded from local storage', 'success');
      }

      function exportJSON() {
        const blob = new Blob([JSON.stringify(canvasData, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'bmc-canvas.json';
        a.click();
        showNotification('JSON exported', 'success');
      }

      async function exportAsImage() {
        const canvas = await html2canvas(document.getElementById('canvasGrid'));
        const link = document.createElement('a');
        link.download = 'bmc-canvas.png';
        link.href = canvas.toDataURL();
        link.click();
        showNotification('Image exported', 'success');
      }

      async function exportAsPDF() {
        const { jsPDF } = window.jspdf;
        const canvas = await html2canvas(document.getElementById('canvasGrid'));
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('l', 'mm', 'a4');
        const imgWidth = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        pdf.save('bmc-canvas.pdf');
        showNotification('PDF exported', 'success');
      }

      function showNotification(text, type = 'success') {
        const notif = document.getElementById('notification');
        const icon = document.getElementById('notifIcon');
        const textEl = document.getElementById('notifText');

        const icons = {
          success: 'fa-check-circle text-green-500',
          error: 'fa-exclamation-circle text-red-500',
          info: 'fa-info-circle text-blue-500',
        };
        icon.className = `fas ${icons[type]} text-2xl`;
        textEl.textContent = text;

        notif.classList.remove('hidden');
        setTimeout(() => notif.classList.add('hidden'), 3000);
      }

      window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024) state.sidebarOpen = true;
      });

      init();
    </script>
  </body>
</html>
